--- 
title: "VariantExperiment"
subtitle: "A RangedSummarizedExperiment container for VCF/GDS data with GDS back-end"
author: 
- name: Qian Liu
  affiliation: Bioconductor Core Team, RPCCC, Buffalo
date: "`r Sys.Date()`"
output: ioslides_presentation
---

```{r options, eval=TRUE, echo=FALSE}
options(showHeadLines=3)
options(showTailLines=3)
```

## VariantExperiment class

- Extends: RangedSummarizedExperiment
```{r, VEclass}
library(VariantExperiment)
(ve <- VariantExperiment())
```
- have exactly same slots and shares the slot accessor functions.

## `VariantExperiment` construction

- From GDS file

```{r, VEgds}
gds <- SeqArray::seqExampleFileName("gds")
ve <- makeSummarizedExperimentFromGDS(gds)
ve
```

---

- From VCF file

```{r, VEvcf}
vcf <- SeqArray::seqExampleFileName("vcf")
ve <- makeSummarizedExperimentFromVCF(vcf)
ve
```

## `VariantExperiment` slots

- Assay data are saved in `GDSArray` objects.
```{r, VEassay}
assays(ve)
assay(ve, 2)
```

--- 

- Annotation data are saved in `DelayedDataFrame` objects.

```{r, VEanno}
rowData(ve)[, 1:8]
```

## subsetting 

The subsetting methods using `[`, `$`, and ranged-based indexes are
very similar as `SummarizedExperiment`.

```{r, subsetRange}
ve1 <- subsetByOverlaps(ve, GRanges("22:1-48958933"))
ve1
```

## Statistical methods

Many statistical functions and methods are defined on
`VariantExperiment` objects, (generics defined in _Bioconductor_
package of `SeqArray` and `SeqVarTools`).     

More details please refer to the vignettes of [SeqArray][], 
[SeqVarTools][] and [VariantExperiment][].

[SeqArray]: https://bioconductor.org/packages/SeqArray
[SeqVarTools]: https://bioconductor.org/packages/SeqVarTools
[VariantExperiment]: https://github.com/Bioconductor/VariantExperiment

---

- hwe

```{r, hwe}
hwe <- hwe(ve)
head(hwe)
```

- titv ratio

```{r, titv}
## by sample
titv <- titv(ve, by.sample=TRUE)
head(titv)
## overall 
titv(ve, by.sample=FALSE)
```

## Save / load `VariantExperiment` object

Because the subsetting on `VariantExperiment` objects are delayed on
both `assay` data and `annotation` data (`GDSArray` or
`DelayedDataFrame` objects with on-disk GDS back end).   

So we need to save the new `VariantExperiment` object to synchronize
the gds file (on-disk) associated with the subset of data (in-memory
representation) before any statistical analysis.

```{r saveLoad, eval=FALSE}
hwe(ve1)
## Error in .saveGDSMaybe(gdsfile) : use
##   'saveVariantExperiment()' to synchronize on-disk and
##   in-memory representations
```
---
 
Use the function `saveVariantExperiment` to synchronize the
on-disk and in-memory representation.

```{r saveVE}
a <- tempfile()
saveVariantExperiment(ve1, dir=a, replace=TRUE)
dir(a)
```

---

reload the synchronized `VariantExperiment` object in specified
directory.

```{r loadVE}
(ve1 <- loadVariantExperiment(dir=a))
gdsfile(ve1)
```

--- 
Now we are all set for any downstream analysis as needed. 
```{r newVEstats}
head(hwe(ve1))
```


## Availability

The development version is available to download through github: 

```{r getDevel, eval=FALSE}
devtools::install_github("Bioconductor/VariantExperiment")
```

